import wixData from "wix-data";
import { v4 as uuidv4 } from "uuid";
export const authOptions = {
    suppressAuth: true,
    suppressHooks: true,
};
export const COLLECTION = "Products";
export async function getProducts(sort, cursor) {
    const query = await wixData.query(COLLECTION);
    const sortedQuery = sort.order === "asc"
        ? query.ascending(sort.field.toString())
        : query.descending(sort.field.toString());
    const products = await sortedQuery
        .skip(cursor.offset)
        .limit(cursor.limit)
        .find(authOptions);
    const nextOffset = cursor.offset + products.items.length;
    const hasNextPage = nextOffset < products.totalCount;
    const actualLimit = hasNextPage ? cursor.limit : products.items.length;
    return {
        items: products.items,
        total: products.totalCount,
        cursor: hasNextPage
            ? {
                limit: actualLimit,
                offset: nextOffset,
            }
            : null,
    };
}
export const addProduct = async (name, price, _id = uuidv4()) => {
    const result = await wixData.insert(COLLECTION, {
        _id,
        title: name,
        price,
    }, authOptions);
    return result || null;
};
export const deleteProduct = async (id) => {
    return wixData.remove(COLLECTION, id, authOptions);
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUHJvZHVjdHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9hcHAvYmFja2VuZC9zdG9yZXMvUHJvZHVjdHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxPQUFPLE1BQU0sVUFBVSxDQUFDO0FBQy9CLE9BQU8sRUFBRSxFQUFFLElBQUksTUFBTSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBNEJwQyxNQUFNLENBQUMsTUFBTSxXQUFXLEdBQUc7SUFDekIsWUFBWSxFQUFFLElBQUk7SUFDbEIsYUFBYSxFQUFFLElBQUk7Q0FDcEIsQ0FBQztBQUVGLE1BQU0sQ0FBQyxNQUFNLFVBQVUsR0FBRyxVQUFVLENBQUM7QUFFckMsTUFBTSxDQUFDLEtBQUssVUFBVSxXQUFXLENBQy9CLElBQVUsRUFDVixNQUFjO0lBRWQsTUFBTSxLQUFLLEdBQUcsTUFBTSxPQUFPLENBQUMsS0FBSyxDQUFDLFVBQVUsQ0FBQyxDQUFDO0lBRTlDLE1BQU0sV0FBVyxHQUNmLElBQUksQ0FBQyxLQUFLLEtBQUssS0FBSztRQUNsQixDQUFDLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBQ3hDLENBQUMsQ0FBQyxLQUFLLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQztJQUU5QyxNQUFNLFFBQVEsR0FBRyxNQUFNLFdBQVc7U0FDL0IsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUM7U0FDbkIsS0FBSyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUM7U0FDbkIsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO0lBRXJCLE1BQU0sVUFBVSxHQUFHLE1BQU0sQ0FBQyxNQUFNLEdBQUcsUUFBUSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUM7SUFDekQsTUFBTSxXQUFXLEdBQUcsVUFBVSxHQUFHLFFBQVEsQ0FBQyxVQUFVLENBQUM7SUFDckQsTUFBTSxXQUFXLEdBQUcsV0FBVyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQztJQUV2RSxPQUFPO1FBQ0wsS0FBSyxFQUFFLFFBQVEsQ0FBQyxLQUFrQjtRQUNsQyxLQUFLLEVBQUUsUUFBUSxDQUFDLFVBQVU7UUFDMUIsTUFBTSxFQUFFLFdBQVc7WUFDakIsQ0FBQyxDQUFDO2dCQUNFLEtBQUssRUFBRSxXQUFXO2dCQUNsQixNQUFNLEVBQUUsVUFBVTthQUNuQjtZQUNILENBQUMsQ0FBQyxJQUFJO0tBQ1QsQ0FBQztBQUNKLENBQUM7QUFFRCxNQUFNLENBQUMsTUFBTSxVQUFVLEdBQUcsS0FBSyxFQUM3QixJQUFZLEVBQ1osS0FBYSxFQUNiLE1BQWMsTUFBTSxFQUFFLEVBQ3RCLEVBQUU7SUFDRixNQUFNLE1BQU0sR0FBRyxNQUFNLE9BQU8sQ0FBQyxNQUFNLENBQ2pDLFVBQVUsRUFDVjtRQUNFLEdBQUc7UUFDSCxLQUFLLEVBQUUsSUFBSTtRQUNYLEtBQUs7S0FDTixFQUNELFdBQVcsQ0FDWixDQUFDO0lBRUYsT0FBUSxNQUFrQixJQUFJLElBQUksQ0FBQztBQUNyQyxDQUFDLENBQUM7QUFFRixNQUFNLENBQUMsTUFBTSxhQUFhLEdBQUcsS0FBSyxFQUFFLEVBQVUsRUFBRSxFQUFFO0lBQ2hELE9BQU8sT0FBTyxDQUFDLE1BQU0sQ0FBQyxVQUFVLEVBQUUsRUFBRSxFQUFFLFdBQVcsQ0FBQyxDQUFDO0FBQ3JELENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB3aXhEYXRhIGZyb20gXCJ3aXgtZGF0YVwiO1xuaW1wb3J0IHsgdjQgYXMgdXVpZHY0IH0gZnJvbSBcInV1aWRcIjtcblxuZXhwb3J0IGludGVyZmFjZSBQcm9kdWN0IHtcbiAgcmVhZG9ubHkgX2lkOiBzdHJpbmc7XG4gIHJlYWRvbmx5IF9jcmVhdGVkRGF0ZTogRGF0ZTtcbiAgcmVhZG9ubHkgX3VwZGF0ZWREYXRlOiBEYXRlO1xuICByZWFkb25seSBfb3duZXJJZDogc3RyaW5nO1xuXG4gIHRpdGxlOiBzdHJpbmc7XG4gIHByaWNlOiBudW1iZXI7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU29ydCB7XG4gIGZpZWxkOiBrZXlvZiBQcm9kdWN0O1xuICBvcmRlcjogXCJhc2NcIiB8IFwiZGVzY1wiO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEN1cnNvciB7XG4gIGxpbWl0OiBudW1iZXI7XG4gIG9mZnNldDogbnVtYmVyO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFBhZ2VkUmVzdWx0IHtcbiAgaXRlbXM6IFByb2R1Y3RbXTtcbiAgdG90YWw6IG51bWJlcjtcbiAgY3Vyc29yPzogQ3Vyc29yO1xufVxuXG5leHBvcnQgY29uc3QgYXV0aE9wdGlvbnMgPSB7XG4gIHN1cHByZXNzQXV0aDogdHJ1ZSxcbiAgc3VwcHJlc3NIb29rczogdHJ1ZSxcbn07XG5cbmV4cG9ydCBjb25zdCBDT0xMRUNUSU9OID0gXCJQcm9kdWN0c1wiO1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0UHJvZHVjdHMoXG4gIHNvcnQ6IFNvcnQsXG4gIGN1cnNvcjogQ3Vyc29yXG4pOiBQcm9taXNlPFBhZ2VkUmVzdWx0PiB7XG4gIGNvbnN0IHF1ZXJ5ID0gYXdhaXQgd2l4RGF0YS5xdWVyeShDT0xMRUNUSU9OKTtcblxuICBjb25zdCBzb3J0ZWRRdWVyeSA9XG4gICAgc29ydC5vcmRlciA9PT0gXCJhc2NcIlxuICAgICAgPyBxdWVyeS5hc2NlbmRpbmcoc29ydC5maWVsZC50b1N0cmluZygpKVxuICAgICAgOiBxdWVyeS5kZXNjZW5kaW5nKHNvcnQuZmllbGQudG9TdHJpbmcoKSk7XG5cbiAgY29uc3QgcHJvZHVjdHMgPSBhd2FpdCBzb3J0ZWRRdWVyeVxuICAgIC5za2lwKGN1cnNvci5vZmZzZXQpXG4gICAgLmxpbWl0KGN1cnNvci5saW1pdClcbiAgICAuZmluZChhdXRoT3B0aW9ucyk7XG5cbiAgY29uc3QgbmV4dE9mZnNldCA9IGN1cnNvci5vZmZzZXQgKyBwcm9kdWN0cy5pdGVtcy5sZW5ndGg7XG4gIGNvbnN0IGhhc05leHRQYWdlID0gbmV4dE9mZnNldCA8IHByb2R1Y3RzLnRvdGFsQ291bnQ7XG4gIGNvbnN0IGFjdHVhbExpbWl0ID0gaGFzTmV4dFBhZ2UgPyBjdXJzb3IubGltaXQgOiBwcm9kdWN0cy5pdGVtcy5sZW5ndGg7XG5cbiAgcmV0dXJuIHtcbiAgICBpdGVtczogcHJvZHVjdHMuaXRlbXMgYXMgUHJvZHVjdFtdLFxuICAgIHRvdGFsOiBwcm9kdWN0cy50b3RhbENvdW50LFxuICAgIGN1cnNvcjogaGFzTmV4dFBhZ2VcbiAgICAgID8ge1xuICAgICAgICAgIGxpbWl0OiBhY3R1YWxMaW1pdCxcbiAgICAgICAgICBvZmZzZXQ6IG5leHRPZmZzZXQsXG4gICAgICAgIH1cbiAgICAgIDogbnVsbCxcbiAgfTtcbn1cblxuZXhwb3J0IGNvbnN0IGFkZFByb2R1Y3QgPSBhc3luYyAoXG4gIG5hbWU6IHN0cmluZyxcbiAgcHJpY2U6IG51bWJlcixcbiAgX2lkOiBzdHJpbmcgPSB1dWlkdjQoKVxuKSA9PiB7XG4gIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHdpeERhdGEuaW5zZXJ0KFxuICAgIENPTExFQ1RJT04sXG4gICAge1xuICAgICAgX2lkLFxuICAgICAgdGl0bGU6IG5hbWUsXG4gICAgICBwcmljZSxcbiAgICB9LFxuICAgIGF1dGhPcHRpb25zXG4gICk7XG5cbiAgcmV0dXJuIChyZXN1bHQgYXMgUHJvZHVjdCkgfHwgbnVsbDtcbn07XG5cbmV4cG9ydCBjb25zdCBkZWxldGVQcm9kdWN0ID0gYXN5bmMgKGlkOiBzdHJpbmcpID0+IHtcbiAgcmV0dXJuIHdpeERhdGEucmVtb3ZlKENPTExFQ1RJT04sIGlkLCBhdXRoT3B0aW9ucyk7XG59O1xuIl19